"use strict";angular.module("lx.form",["lx.cache"]).factory("lxForm",["lxCache",function(a){return function(b,c){var d={},e={};return d.model={},d.reset=function(f){f&&(d.resetValidation(f),f.$setPristine(),f.$setUntouched()),d.model=angular.copy(e),c&&(d.model[c]?a[d.model[c]]=d.model:a[b]=d.model)},d.isUnchanged=function(){return angular.equals(d.model,e)},d.hasLoadedModelFromCache=function(c){return c&&a[c]?(d.model=a[c],a[c+"_Master"]&&(e=a[c+"_Master"]),!0):c?!1:(a[b]?d.model=a[b]:a[b]=d.model,!0)},d.setModel=function(f,g){!d.model[c]&&g&&delete a[b],d.model=f,e=angular.copy(f),g?(delete a[f[c]],delete a[f[c]+"_Master"]):(a[f[c]]=d.model,a[f[c]+"_Master"]=e)},d.populateServerValidation=function(a,b){b&&(d.resetServerErrors(a),angular.forEach(b,function(b){var c=b.property.toLowerCase();a[c]&&(a[c].$setValidity("server",!1),a[c].$error.serverMsg=b.message)}))},d.resetServerErrors=function(a){angular.forEach(a,function(a){a&&a.$error&&a.$error.serverMsg&&(a.$setValidity("server",!0),delete a.$error.serverMsg)})},d.resetValidation=function(a){angular.forEach(a,function(a,b){b&&"$"!==b[0]&&(angular.forEach(a.$error,function(b,c){a.$setValidity(c,!0),a.$setViewValue("")}),a.$setPristine())})},d}}]),describe("lx form service",function(){var a;beforeEach(function(){module("lx.cache"),module("lx.form")}),describe("lxForm",function(){beforeEach(function(){inject(function(b){a=b.get("lxForm")("test","id")})}),it("should be initialized correctly",function(){expect(a.model).toBeDefined(),expect(a.reset).toBeDefined(),expect(a.isUnchanged).toBeDefined(),expect(a.hasLoadedModelFromCache).toBeDefined(),expect(a.setModel).toBeDefined(),expect(a.populateServerValidation).toBeDefined()}),describe("isUnchanged()",function(){it("should return true if there are no changes to the model",function(){expect(a.isUnchanged()).toBeTruthy()}),it("should return false if the model has changes",function(){a.model.test=1,expect(a.isUnchanged()).toBeFalsy()})}),describe("setModel()",function(){it("should set the model and store it in cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),expect(a.model).toEqual(b),inject(function(a){var c=a.get("lxCache");expect(c[1]).toEqual(b),expect(c["1_Master"]).toEqual(b)})}),it("should delete the old model from cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),a.setModel(b,!0),expect(a.model).toEqual(b),inject(function(a){var b=a.get("lxCache");expect(b[1]).toBeUndefined(),expect(b["1_Master"]).toBeUndefined()})}),it("should delete the old model from cache",function(){var b={name:"wayne",age:99};inject(function(c){var d=c.get("lxCache");d.test=123,a.setModel(b,!0),expect(a.model).toEqual(b),expect(d.test).toBeUndefined()})})}),describe("reset()",function(){it("should reset the model to initial state",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),a.model.age=66,a.reset(),expect(a.model).toEqual({id:1,name:"wayne",age:99}),inject(function(a){var b=a.get("lxCache");expect(b[1]).toEqual({id:1,name:"wayne",age:99})})}),it("should reset the form errors",function(){var b={id:1,name:"wayne",age:99},c={$error:{id:"required"},$setPristine:function(){},$setUntouched:function(){}};a.setModel(b),a.model.age=66,a.reset(c),expect(a.model).toEqual({id:1,name:"wayne",age:99})}),it("should reset the model to initial state without key",function(){var b={name:"wayne",age:99};a.setModel(b),a.model.age=66,a.reset(),expect(a.model).toEqual({name:"wayne",age:99}),inject(function(a){var b=a.get("lxCache");expect(b.test).toEqual({name:"wayne",age:99})})})}),describe("hasLoadedModelFromCache()",function(){it("should has model in cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b);var c=a.hasLoadedModelFromCache("1");expect(c).toBeTruthy()}),it("should has not model in cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b);var c=a.hasLoadedModelFromCache("2");expect(c).toBeFalsy()}),it("should has model in cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b);var c=a.hasLoadedModelFromCache();expect(c).toBeTruthy()}),it("should has model in cache",function(){var b={id:"test",name:"wayne",age:99};a.setModel(b);var c=a.hasLoadedModelFromCache();expect(c).toBeTruthy()}),it("should return true without master in cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),inject(function(a){var b=a.get("lxCache");delete b["1_Master"]});var c=a.hasLoadedModelFromCache("1");expect(c).toBeTruthy()})})}),describe("lxForm partially initialized",function(){beforeEach(function(){inject(function(b){a=b.get("lxForm")("test")})}),describe("reset()",function(){it("should reset the model to initial state without refreshing the cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),a.model.age=66,a.reset(),expect(a.model).toEqual({id:1,name:"wayne",age:99}),inject(function(a){var b=a.get("lxCache");expect(b[1]).not.toEqual({id:1,name:"wayne",age:99})})})}),describe("reset()",function(){it("should reset the model to initial state without refreshing the cache",function(){var b={id:1,name:"wayne",age:99};a.setModel(b),a.model.age=66,a.reset(),expect(a.model).toEqual({id:1,name:"wayne",age:99}),inject(function(a){var b=a.get("lxCache");expect(b.undefined).not.toEqual({id:1,name:"wayne",age:99})})})})})});
//# sourceMappingURL=lx_form.min.js.map